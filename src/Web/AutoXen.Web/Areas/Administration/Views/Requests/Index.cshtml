@using AutoXen.Web.ViewModels.Administration.Requests
@using AutoXen.Common
@using AutoXen.Data.Models
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@model RequestsViewModel
@{
    this.ViewData["Title"] = "Requests";
}

<div class="d-flex justify-content-center mt-4">
    <table class="table table-sm table-hover border border-dark table-bordered col-md-10">
        <thead class="thead-dark">
            <tr>
                <th class="text-center">
                    User
                </th>
                <th class="text-center">
                    Created on
                </th>
                <th class="text-center">
                    Request type
                </th>
                <th class="text-center">
                    Accepted
                </th>
                <th class="text-center">
                    Info
                </th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Requests != null)
            {
                @foreach (var request in Model.Requests)
                {
                    ApplicationUser curUser = this.UserManager.GetUserAsync(this.User).GetAwaiter().GetResult();
                    <tr>
                        <td>@($"First name: {request.User.FirstName} - Sur name: {request.User.SurName}")</td>
                        <td name="date">@request.CreatedOn</td>
                        <td>@request.RequestName</td>
                        @if (request.AcceptedById == null)
                        {
                            <td class="text-center"><a asp-controller="Requests" asp-action="AcceptRequest" asp-area="Administration" asp-route-requestName="@request.RequestName" asp-route-id="@request.Id" class="btn btn-outline-secondary">Accept</a></td>
                        }
                        else if (request.AcceptedById == curUser.Id)
                        {
                            <td class="text-center"><a asp-controller="Email" asp-action="Send" asp-area="Administration" asp-route-requestName="@request.RequestName" asp-route-id="@request.Id" class="btn btn-outline-primary">Send email</a></td>
                        }
                        else
                        {
                            <td class="text-center align-middle">Accepted</td>
                        }
                        @if (request.RequestName == GlobalConstants.Workshop)
                        {
                            <td class="text-center"><a asp-controller="Workshops" asp-action="Details" asp-route-id="@request.Id" class="btn btn-outline-info">Info</a></td>
                        }
                        else if (request.RequestName == GlobalConstants.CarWash)
                        {
                            <td class="text-center"><a asp-controller="CarWashes" asp-action="Details" asp-route-id="@request.Id" class="btn btn-outline-info">Info</a></td>
                        }
                    </tr>
                }
            }
        </tbody>
    </table>
</div>
<div class="d-flex justify-content-center">
    <div class="row">
        <partial name="_PagingPartial" model="@Model" />
    </div>
</div>